#!/usr/bin/env bash

# Pre-commit hook: rebuild feedback-layer bundle when source files change

staged_src=$(git diff --cached --name-only -- 'feedback-layer/src/')

if [ -z "$staged_src" ]; then
  exit 0
fi

echo "feedback-layer/src/ changes detected â€” rebuilding bundle..."

# Use the root build script (not feedback-layer's) because it handles the full
# pipeline: build the bundle AND copy it to serve/feedback-layer.js where the
# server actually serves it from.
# Note: git runs hooks from the repo root, so this resolves to the root package.json.
npm run build
if [ $? -ne 0 ]; then
  echo "ERROR: feedback-layer build failed. Commit aborted."
  exit 1
fi

git add serve/feedback-layer.js
